2025-07-21 11:15:16,846 - INFO - æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œæ—¥å¿—æ–‡ä»¶: /mnt/nvme0n1/tyj/TKGQA/MY/logs/experiment_20250721_111516.log
2025-07-21 11:15:16,878 - INFO - TemporalKGQASystem åˆå§‹åŒ–å®Œæˆ
2025-07-21 11:15:16,878 - INFO - åŠ è½½çŸ¥è¯†å›¾è°±: MY/data/output/full_df.txt
2025-07-21 11:15:17,244 - INFO - æ•°æ®å½¢çŠ¶: (461329, 4)
2025-07-21 11:15:17,244 - INFO - åˆ—å: ['head', 'relation', 'tail', 'timestamp']
2025-07-21 11:15:17,280 - INFO - çŸ¥è¯†å›¾è°±åŠ è½½å®Œæˆï¼Œå…± 461329 æ¡è®°å½•
2025-07-21 11:15:17,280 - INFO - æ—¶é—´èŒƒå›´: 2005-01-01 00:00:00 åˆ° 2015-12-31 00:00:00
2025-07-21 11:15:17,280 - INFO - åŠ è½½é—®é¢˜æ•°æ®: MY/data/multitq/questions/question_6.json
2025-07-21 11:15:17,280 - INFO - é—®é¢˜æ•°æ®åŠ è½½å®Œæˆï¼Œå…± 6 ä¸ªé—®é¢˜
2025-07-21 11:15:17,280 - INFO - å¤„ç†é—®é¢˜ 1: 2056020
2025-07-21 11:15:17,280 - INFO - é—®é¢˜: When did Walker San Miguel first express interest in working with Bolivia?
2025-07-21 11:15:17,280 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['2007-07-24']
2025-07-21 11:15:17,280 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:15:17,468 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:15:26,737 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'time_query', 'key_entities': ['Walker San Miguel', 'Bolivia'], 'target_relations': ['express interest in working with'], 'time_constraints': '', 'answer_type': 'time', 'query_strategy': "é¦–å…ˆè¯†åˆ«å‡ºä¸»ä½“å®ä½“'Walker San Miguel'å’Œç›®æ ‡å®ä½“'Bolivia'ï¼Œç„¶åæŸ¥è¯¢ä¸¤è€…ä¹‹é—´'express interest in working with'å…³ç³»çš„æ—¶é—´ä¿¡æ¯ã€‚"}
2025-07-21 11:15:26,737 - INFO - åˆ†æç»“æœ: {'question_type': 'time_query', 'key_entities': ['Walker San Miguel', 'Bolivia'], 'target_relations': ['express interest in working with'], 'time_constraints': '', 'answer_type': 'time', 'query_strategy': "é¦–å…ˆè¯†åˆ«å‡ºä¸»ä½“å®ä½“'Walker San Miguel'å’Œç›®æ ‡å®ä½“'Bolivia'ï¼Œç„¶åæŸ¥è¯¢ä¸¤è€…ä¹‹é—´'express interest in working with'å…³ç³»çš„æ—¶é—´ä¿¡æ¯ã€‚"}
2025-07-21 11:15:26,737 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:15:26,737 - INFO - æ£€æŸ¥å®ä½“: 'Walker San Miguel'
2025-07-21 11:15:27,140 - INFO -   æ¨¡å¼ 'Walker_San_Miguel' åŒ¹é…æˆåŠŸ:
2025-07-21 11:15:27,140 - INFO -     ä½œä¸ºhead: 27 æ¡è®°å½•
2025-07-21 11:15:27,141 - INFO -       Walker_San_Miguel -> Make_a_visit -> China (2006-08-30)
2025-07-21 11:15:27,141 - INFO -       Walker_San_Miguel -> Praise_or_endorse -> China (2006-08-30)
2025-07-21 11:15:27,141 - INFO -       Walker_San_Miguel -> Make_statement -> Evo_Morales (2006-09-19)
2025-07-21 11:15:27,141 - INFO -     ä½œä¸ºtail: 14 æ¡è®°å½•
2025-07-21 11:15:27,141 - INFO -       China -> Host_a_visit -> Walker_San_Miguel (2006-08-30)
2025-07-21 11:15:27,141 - INFO -       Walker_San_Miguel -> Make_statement -> Walker_San_Miguel (2006-11-02)
2025-07-21 11:15:27,141 - INFO -       Bolivia -> Consult -> Walker_San_Miguel (2006-11-04)
2025-07-21 11:15:27,141 - INFO - æ£€æŸ¥å®ä½“: 'Bolivia'
2025-07-21 11:15:27,327 - INFO -   æ¨¡å¼ 'Bolivia' åŒ¹é…æˆåŠŸ:
2025-07-21 11:15:27,327 - INFO -     ä½œä¸ºhead: 945 æ¡è®°å½•
2025-07-21 11:15:27,327 - INFO -       Bolivia -> Host_a_visit -> Combatant_(Argentina) (2005-01-06)
2025-07-21 11:15:27,327 - INFO -       Bolivia -> Rally_opposition_against -> France (2005-01-11)
2025-07-21 11:15:27,328 - INFO -       Bolivia -> Consult -> China (2005-01-27)
2025-07-21 11:15:27,328 - INFO -     ä½œä¸ºtail: 1335 æ¡è®°å½•
2025-07-21 11:15:27,328 - INFO -       Combatant_(Argentina) -> Make_a_visit -> Bolivia (2005-01-06)
2025-07-21 11:15:27,328 - INFO -       Rodrigo_Rato -> Express_intent_to_meet_or_negotiate -> Bolivia (2005-01-14)
2025-07-21 11:15:27,328 - INFO -       China -> Consult -> Bolivia (2005-01-27)
2025-07-21 11:15:27,328 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:15:27,352 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:15:27,352 - INFO -   å…³ç³» 'express interest in working with' æ¨¡ç³ŠåŒ¹é…: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Express_intent_to_provide_economic_aid', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Arrest,_detain,_or_charge_with_legal_action', 'Express_intent_to_cooperate_economically', 'Express_intent_to_cooperate', 'Express_intent_to_provide_humanitarian_aid', 'Express_accord']
2025-07-21 11:15:27,380 - INFO -     'Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)': 9704 æ¡è®°å½•
2025-07-21 11:15:27,405 - INFO -     'Express_intent_to_provide_economic_aid': 576 æ¡è®°å½•
2025-07-21 11:15:27,432 - INFO -     'fight_with_small_arms_and_light_weapons': 5386 æ¡è®°å½•
2025-07-21 11:15:27,432 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:15:27,432 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:15:27,498 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:15:52,163 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:15:52,163 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1535 å­—ç¬¦
2025-07-21 11:15:52,163 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    æŸ¥è¯¢Walker San Miguelé¦–æ¬¡è¡¨è¾¾ä¸Boliviaåˆä½œæ„å‘çš„æ—¶é—´
    å‚æ•°:
        df: çŸ¥è¯†å›¾è°±DataFrameï¼ŒåŒ…å«åˆ—['head', 'relation', 'tail', 'timestamp']
    è¿”å›:
        æ—¶é—´å­—ç¬¦ä¸²åˆ—è¡¨(æŒ‰æ—¶é—´æ’åº)
    """
    # å®ä½“åç§°å¤„ç†ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰
    subject_entities = ['Walker_San_Miguel', 'Walker San Miguel']
    object_entities = ['Bolivia']
    
    # å…³ç³»æ˜ å°„ï¼ˆæ ¹æ®å¸¸è§å…³ç³»æ˜ å°„ï¼‰
    relations = ['Express_intent_to_cooperate']
    
    # æŸ¥è¯¢åŒ¹é…çš„è®°å½•
    records = []
    for sub in subject_entities:
        for obj in object_entities:
            # å¤„ç†å®ä½“åç§°æ ¼å¼ï¼ˆä¸‹åˆ’çº¿æˆ–ç©ºæ ¼ï¼‰
            sub_pattern = sub.replace(' ', '_')
            obj_pattern = obj.replace(' ', '_')
            
            # æŸ¥è¯¢åŒ¹é…çš„è®°å½•
            mask = (
                (df['head'].str.contains(sub_pattern, case=False, regex=True) | 
                (df['head'] == sub)
            ) & (
                (df['tail'].str.contains(obj_pattern, case=False, regex=True) |
                (df['tail'] == obj)
            ) & (
                df['relation'].isin(relations)
            ))
            
            filtered = df[mask]
            if not filtered.empty:
                records.extend(filtered.to_dict('records'))
    
    if not records:
        return []
    
    # è½¬æ¢ä¸ºDataFrameä»¥ä¾¿æ’åº
    result_df = pd.DataFrame(records)
    
    # æŒ‰æ—¶é—´å‡åºæ’åº
    result_df['timestamp'] = pd.to_datetime(result_df['timestamp'])
    result_df = result_df.sort_values('timestamp')
    
    # è·å–æœ€æ—©çš„æ—¶é—´è®°å½•
    earliest_record = result_df.iloc[0]
    
    # è¿”å›æ—¶é—´å­—ç¬¦ä¸²
    return [str(earliest_record['timestamp'])]
2025-07-21 11:15:52,163 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:15:52,163 - ERROR - æŸ¥è¯¢æ‰§è¡Œå¤±è´¥: '(' was never closed (<string>, line 27)
2025-07-21 11:15:52,164 - ERROR - é”™è¯¯è¯¦æƒ…: Traceback (most recent call last):
  File "/mnt/nvme0n1/tyj/TKGQA/MY/query_executor.py", line 29, in execute_query
    exec(query_code, exec_globals)
  File "<string>", line 27
    mask = (
           ^
SyntaxError: '(' was never closed

2025-07-21 11:15:52,164 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:15:52,164 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:15:52,164 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:15:52,164 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['2007-07-24']
2025-07-21 11:15:52,164 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:15:52,164 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:15:52,164 - INFO -   å¤„ç†æ—¶é—´: 34.884ç§’
2025-07-21 11:15:52,164 - INFO - å¤„ç†é—®é¢˜ 2: 2027657
2025-07-21 11:15:52,164 - INFO - é—®é¢˜: Who wanted to cooperate with Japan on 23 August 2006?
2025-07-21 11:15:52,164 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Association of Southeast Asian Nations']
2025-07-21 11:15:52,164 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:15:52,217 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:16:01,428 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Japan'], 'target_relations': ['wanted to cooperate with'], 'time_constraints': '23 August 2006', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆåœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­å®šä½åˆ°2006å¹´8æœˆ23æ—¥çš„æ—¶é—´èŠ‚ç‚¹ï¼Œç„¶åæŸ¥æ‰¾ä¸Japanå­˜åœ¨'wanted to cooperate with'å…³ç³»çš„å®ä½“ï¼Œè¿”å›è¯¥å®ä½“ä½œä¸ºç­”æ¡ˆã€‚"}
2025-07-21 11:16:01,428 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Japan'], 'target_relations': ['wanted to cooperate with'], 'time_constraints': '23 August 2006', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆåœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­å®šä½åˆ°2006å¹´8æœˆ23æ—¥çš„æ—¶é—´èŠ‚ç‚¹ï¼Œç„¶åæŸ¥æ‰¾ä¸Japanå­˜åœ¨'wanted to cooperate with'å…³ç³»çš„å®ä½“ï¼Œè¿”å›è¯¥å®ä½“ä½œä¸ºç­”æ¡ˆã€‚"}
2025-07-21 11:16:01,428 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:16:01,428 - INFO - æ£€æŸ¥å®ä½“: 'Japan'
2025-07-21 11:16:01,663 - INFO -   æ¨¡å¼ 'Japan' åŒ¹é…æˆåŠŸ:
2025-07-21 11:16:01,663 - INFO -     ä½œä¸ºhead: 15572 æ¡è®°å½•
2025-07-21 11:16:01,663 - INFO -       Government_Official_(Japan) -> Consult -> Emperor_Akihito (2005-01-01)
2025-07-21 11:16:01,663 - INFO -       Japan -> Express_intent_to_provide_material_aid -> International_Government_Organizations (2005-01-01)
2025-07-21 11:16:01,663 - INFO -       Japan -> Consult -> China (2005-01-03)
2025-07-21 11:16:01,664 - INFO -     ä½œä¸ºtail: 18845 æ¡è®°å½•
2025-07-21 11:16:01,664 - INFO -       Emperor_Akihito -> Consult -> Government_Official_(Japan) (2005-01-01)
2025-07-21 11:16:01,664 - INFO -       China -> Threaten -> Japan (2005-01-02)
2025-07-21 11:16:01,664 - INFO -       China -> Consult -> Japan (2005-01-03)
2025-07-21 11:16:01,664 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:16:01,689 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:16:01,689 - INFO -   å…³ç³» 'wanted to cooperate with' æ¨¡ç³ŠåŒ¹é…: ['fight_with_small_arms_and_light_weapons', 'Arrest,_detain,_or_charge_with_legal_action', 'Express_intent_to_cooperate_economically', 'Express_intent_to_cooperate', 'Threaten_with_military_force', 'Cooperate_militarily', 'Cooperate_economically', 'fight_with_artillery_and_tanks', 'Express_intent_to_cooperate_on_judicial_matters', 'Threaten_with_sanctions,_boycott,_embargo']
2025-07-21 11:16:01,716 - INFO -     'fight_with_small_arms_and_light_weapons': 5386 æ¡è®°å½•
2025-07-21 11:16:01,748 - INFO -     'Arrest,_detain,_or_charge_with_legal_action': 22069 æ¡è®°å½•
2025-07-21 11:16:01,773 - INFO -     'Express_intent_to_cooperate_economically': 744 æ¡è®°å½•
2025-07-21 11:16:01,773 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:16:01,773 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:16:01,830 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:16:27,247 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:16:27,247 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1740 å­—ç¬¦
2025-07-21 11:16:27,247 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    Query the temporal knowledge graph to find who wanted to cooperate with Japan on 23 August 2006.
    
    Args:
        df (pd.DataFrame): The knowledge graph dataframe with columns ['head', 'relation', 'tail', 'timestamp']
        
    Returns:
        list: List of entity names (with underscores replaced by spaces) that wanted to cooperate with Japan on the specified date
    """
    # Map the natural language relation to KG relations
    relation_mapping = [
        "Express_intent_to_cooperate",
        "Engage_in_diplomatic_cooperation"
    ]
    
    # Prepare target entities (Japan in various formats)
    target_entities = ["Japan", "japan"]
    
    # Convert the date to proper format for comparison
    target_date = "2006-08-23"
    
    try:
        # Filter by date (just the date part, ignoring time)
        df['date'] = pd.to_datetime(df['timestamp']).dt.date
        target_date_obj = pd.to_datetime(target_date).date()
        date_filtered = df[df['date'] == target_date_obj]
        
        # Filter by relations and Japan as tail entity
        relation_filtered = date_filtered[
            date_filtered['relation'].isin(relation_mapping) & 
            date_filtered['tail'].str.contains('|'.join(target_entities), case=False)
        ]
        
        # Get unique head entities
        results = relation_filtered['head'].unique()
        
        # Convert underscores to spaces and return
        return [entity.replace('_', ' ') for entity in results]
    
    except Exception as e:
        print(f"Error during query: {e}")
        return []

# Example usage:
# df = pd.read_csv('your_knowledge_graph.csv')
# results = query_kg(df)
# print(results)
2025-07-21 11:16:27,247 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:16:27,389 - INFO - æŸ¥è¯¢è¿”å› 2 ä¸ªç»“æœ: ['Association of Southeast Asian Nations', 'Vietnam']
2025-07-21 11:16:27,390 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:16:27,390 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:16:27,390 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['Association of Southeast Asian Nations', 'Vietnam']
2025-07-21 11:16:27,390 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Association of Southeast Asian Nations']
2025-07-21 11:16:27,390 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:16:27,390 - INFO -   ç²¾åº¦: 0.500, å¬å›ç‡: 1.000, F1: 0.667
2025-07-21 11:16:27,390 - INFO -   å¤„ç†æ—¶é—´: 35.225ç§’
2025-07-21 11:16:27,390 - INFO - å¤„ç†é—®é¢˜ 3: 2007873
2025-07-21 11:16:27,390 - INFO - é—®é¢˜: Before 11 December 2009, who used conventional military force against France?
2025-07-21 11:16:27,390 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Separatist (France)', 'Comoros', 'Royal Air Force', 'Bolivia', 'Colombia', 'Christian (France)', 'Member of Parliament (France)', 'Military (Russia)']
2025-07-21 11:16:27,390 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:16:27,444 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:16:35,154 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'entity_query', 'key_entities': ['France'], 'target_relations': ['used conventional military force against'], 'time_constraints': 'before 11 December 2009', 'answer_type': 'entity', 'query_strategy': 'æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰å¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“'}
2025-07-21 11:16:35,154 - INFO - åˆ†æç»“æœ: {'question_type': 'entity_query', 'key_entities': ['France'], 'target_relations': ['used conventional military force against'], 'time_constraints': 'before 11 December 2009', 'answer_type': 'entity', 'query_strategy': 'æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰å¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“'}
2025-07-21 11:16:35,154 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:16:35,154 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:16:35,343 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:16:35,343 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:16:35,343 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:16:35,343 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:16:35,343 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:16:35,343 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:16:35,344 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:16:35,344 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:16:35,344 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:16:35,344 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:16:35,368 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:16:35,368 - INFO -   å…³ç³» 'used conventional military force against' æ¨¡ç³ŠåŒ¹é…: ['Use_unconventional_violence', 'Use_conventional_military_force', 'Provide_military_aid', 'Mobilize_or_increase_armed_forces', 'Refuse_to_de-escalate_military_engagement', 'Bring_lawsuit_against', 'Increase_military_alert_status', 'Provide_military_protection_or_peacekeeping', 'Demonstrate_military_or_police_power', 'Rally_opposition_against']
2025-07-21 11:16:35,396 - INFO -     'Use_unconventional_violence': 9189 æ¡è®°å½•
2025-07-21 11:16:35,424 - INFO -     'Use_conventional_military_force': 9554 æ¡è®°å½•
2025-07-21 11:16:35,450 - INFO -     'Provide_military_aid': 452 æ¡è®°å½•
2025-07-21 11:16:35,450 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:16:35,450 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:16:35,508 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:16:57,573 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:16:57,573 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1171 å­—ç¬¦
2025-07-21 11:16:57,573 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd
from datetime import datetime

def query_kg(df):
    """
    æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰å¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“
    
    å‚æ•°:
    df (pd.DataFrame): æ—¶åºçŸ¥è¯†å›¾è°±DataFrameï¼ŒåŒ…å«åˆ—['head', 'relation', 'tail', 'timestamp']
    
    è¿”å›:
    list: ç¬¦åˆæ¡ä»¶çš„å®ä½“åç§°åˆ—è¡¨(ä¸‹åˆ’çº¿è½¬ç©ºæ ¼)
    """
    # å®šä¹‰ç›®æ ‡å®ä½“å’Œå…³ç³»çš„å¤šç§å¯èƒ½è¡¨è¾¾
    target_entities = ['France', 'French']
    relations = ['Use_conventional_military_force']
    
    # è½¬æ¢æ—¶é—´çº¦æŸ
    cutoff_date = datetime.strptime('2009-12-11 00:00:00', '%Y-%m-%d %H:%M:%S')
    
    try:
        # ç­›é€‰æ¡ä»¶:
        # 1. å…³ç³»åŒ¹é…å†›äº‹åŠ›é‡ä½¿ç”¨
        # 2. å°¾éƒ¨å®ä½“æ˜¯æ³•å›½(ä¸åŒºåˆ†å¤§å°å†™)
        # 3. æ—¶é—´åœ¨2009-12-11ä¹‹å‰
        filtered = df[
            (df['relation'].isin(relations)) &
            (df['tail'].str.contains('|'.join(target_entities), case=False)) &
            (pd.to_datetime(df['timestamp']) < cutoff_date)
        ]
        
        # è·å–å”¯ä¸€å®ä½“å¹¶è½¬æ¢æ ¼å¼
        results = filtered['head'].unique().tolist()
        results = [x.replace('_', ' ') for x in results]
        
        return results
    
    except Exception as e:
        print(f"æŸ¥è¯¢è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
        return []

# ç¤ºä¾‹ç”¨æ³•:
# df = pd.read_csv('your_knowledge_graph.csv')  # å‡è®¾å·²åŠ è½½KGæ•°æ®
# results = query_kg(df)
# print(results)
2025-07-21 11:16:57,574 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:16:57,795 - INFO - æŸ¥è¯¢è¿”å› 15 ä¸ªç»“æœ: ['Bolivia', 'Military Personnel - Special (France)', 'Colombia', 'France', 'Military (Russia)', 'Member of Parliament (France)', 'Military (Senegal)', "Police (Cote d'Ivoire)", 'Religion (France)', 'Christian (France)', 'Royal Air Force', 'Actor (France)', 'Corsica', 'Separatist (France)', 'Comoros']
2025-07-21 11:16:57,795 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:16:57,795 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:16:57,796 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['Bolivia', 'Military Personnel - Special (France)', 'Colombia', 'France', 'Military (Russia)', 'Member of Parliament (France)', 'Military (Senegal)', "Police (Cote d'Ivoire)", 'Religion (France)', 'Christian (France)', 'Royal Air Force', 'Actor (France)', 'Corsica', 'Separatist (France)', 'Comoros']
2025-07-21 11:16:57,796 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Separatist (France)', 'Comoros', 'Royal Air Force', 'Bolivia', 'Colombia', 'Christian (France)', 'Member of Parliament (France)', 'Military (Russia)']
2025-07-21 11:16:57,796 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:16:57,796 - INFO -   ç²¾åº¦: 0.533, å¬å›ç‡: 1.000, F1: 0.696
2025-07-21 11:16:57,796 - INFO -   å¤„ç†æ—¶é—´: 30.405ç§’
2025-07-21 11:16:57,796 - INFO - å¤„ç†é—®é¢˜ 4: 2044815
2025-07-21 11:16:57,796 - INFO - é—®é¢˜: Which country was the first to ask for France after the Algerian extremist?
2025-07-21 11:16:57,796 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Iran']
2025-07-21 11:16:57,796 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:16:57,846 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:17:07,452 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Algerian extremist', 'France'], 'target_relations': ['ask for'], 'time_constraints': 'first', 'answer_type': 'entity', 'query_strategy': "The question asks for the country that first asked for France after the Algerian extremist. The key entities are 'Algerian extremist' and 'France', with the target relation being 'ask for'. The time constraint is 'first', indicating the earliest occurrence of this event. The answer is expected to be an entity (a country)."}
2025-07-21 11:17:07,453 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Algerian extremist', 'France'], 'target_relations': ['ask for'], 'time_constraints': 'first', 'answer_type': 'entity', 'query_strategy': "The question asks for the country that first asked for France after the Algerian extremist. The key entities are 'Algerian extremist' and 'France', with the target relation being 'ask for'. The time constraint is 'first', indicating the earliest occurrence of this event. The answer is expected to be an entity (a country)."}
2025-07-21 11:17:07,453 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:17:07,453 - INFO - æ£€æŸ¥å®ä½“: 'Algerian extremist'
2025-07-21 11:17:08,367 - WARNING -   å®ä½“ 'Algerian extremist' çš„æ‰€æœ‰æ¨¡å¼éƒ½æœªæ‰¾åˆ°
2025-07-21 11:17:08,737 - INFO -     éƒ¨åˆ†åŒ¹é… 'extremist': 242 æ¡è®°å½•
2025-07-21 11:17:08,737 - INFO -       Agence_France-Presse -> Make_statement -> Extremist_(Algeria)
2025-07-21 11:17:08,737 - INFO -       Islamic_Extremist_Group_(Islamic_Jihad) -> fight_with_small_arms_and_light_weapons -> Israeli_Defense_Forces
2025-07-21 11:17:08,737 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:17:08,938 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:17:08,938 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:17:08,938 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:17:08,939 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:17:08,939 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:17:08,939 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:17:08,939 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:17:08,939 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:17:08,939 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:17:08,939 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:17:08,964 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:17:08,965 - WARNING -   å…³ç³» 'ask for' æœªæ‰¾åˆ°åŒ¹é…
2025-07-21 11:17:08,965 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:17:08,965 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:17:09,023 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:17:31,807 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:17:31,807 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1800 å­—ç¬¦
2025-07-21 11:17:31,807 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    Query the knowledge graph to find which country was the first to ask for France 
    after the Algerian extremist.
    
    Args:
        df (pd.DataFrame): Knowledge graph dataframe with columns ['head', 'relation', 'tail', 'timestamp']
        
    Returns:
        list: List of country names (with underscores replaced by spaces) that match the query
    """
    
    # Map the target relation to KG relations
    target_relations = ['Make_an_appeal_or_request', 'Appeal_to']
    
    # Identify Algerian extremist and France entities (using flexible matching)
    algerian_extremist_mask = df['head'].str.contains('Algerian_extremist|Algerian_terrorist', case=False, regex=True)
    france_mask = df['tail'].str.contains('France|French', case=False, regex=True)
    
    # Filter for events where someone asked France (after Algerian extremist event)
    relation_mask = df['relation'].isin(target_relations)
    
    # Find the earliest Algerian extremist event timestamp
    algerian_events = df[algerian_extremist_mask]
    if algerian_events.empty:
        return []
    
    earliest_algerian_time = algerian_events['timestamp'].min()
    
    # Filter for requests to France that happened after the Algerian extremist event
    time_mask = df['timestamp'] > earliest_algerian_time
    filtered_events = df[france_mask & relation_mask & time_mask]
    
    if filtered_events.empty:
        return []
    
    # Find the earliest request event
    earliest_request = filtered_events.loc[filtered_events['timestamp'].idxmin()]
    
    # Get the requesting country (head entity)
    requesting_country = earliest_request['head']
    
    # Return as list with underscores replaced by spaces
    return [requesting_country.replace('_', ' ')]
2025-07-21 11:17:31,807 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:17:32,130 - INFO - æŸ¥è¯¢è¿”å› 0 ä¸ªç»“æœ: []
2025-07-21 11:17:32,130 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:17:32,130 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:17:32,130 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:17:32,130 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Iran']
2025-07-21 11:17:32,130 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:17:32,130 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:17:32,130 - INFO -   å¤„ç†æ—¶é—´: 34.334ç§’
2025-07-21 11:17:32,130 - INFO - å¤„ç†é—®é¢˜ 5: 2016117
2025-07-21 11:17:32,130 - INFO - é—®é¢˜: Before the Brazilian Ministry of Agriculture, Fishing and Forestry, which country was the last to condemn France?
2025-07-21 11:17:32,130 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Mexico']
2025-07-21 11:17:32,130 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:17:32,183 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:17:40,819 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'entity_query', 'key_entities': ['Brazilian Ministry of Agriculture, Fishing and Forestry', 'France'], 'target_relations': ['condemn'], 'time_constraints': 'before the Brazilian Ministry of Agriculture, Fishing and Forestry', 'answer_type': 'entity', 'query_strategy': "Find the last country that condemned France before the Brazilian Ministry of Agriculture, Fishing and Forestry did. This involves identifying the temporal sequence of condemnations against France and selecting the one immediately preceding the Brazilian Ministry's action."}
2025-07-21 11:17:40,819 - INFO - åˆ†æç»“æœ: {'question_type': 'entity_query', 'key_entities': ['Brazilian Ministry of Agriculture, Fishing and Forestry', 'France'], 'target_relations': ['condemn'], 'time_constraints': 'before the Brazilian Ministry of Agriculture, Fishing and Forestry', 'answer_type': 'entity', 'query_strategy': "Find the last country that condemned France before the Brazilian Ministry of Agriculture, Fishing and Forestry did. This involves identifying the temporal sequence of condemnations against France and selecting the one immediately preceding the Brazilian Ministry's action."}
2025-07-21 11:17:40,819 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:17:40,819 - INFO - æ£€æŸ¥å®ä½“: 'Brazilian Ministry of Agriculture, Fishing and Forestry'
2025-07-21 11:17:41,682 - WARNING -   å®ä½“ 'Brazilian Ministry of Agriculture, Fishing and Forestry' çš„æ‰€æœ‰æ¨¡å¼éƒ½æœªæ‰¾åˆ°
2025-07-21 11:17:41,867 - INFO -     éƒ¨åˆ†åŒ¹é… 'Brazilian': 4 æ¡è®°å½•
2025-07-21 11:17:41,867 - INFO -       Brazilian_Communist_Party -> Engage_in_material_cooperation -> Socialism_and_Freedom_Party
2025-07-21 11:17:41,867 - INFO -       Socialism_and_Freedom_Party -> Engage_in_material_cooperation -> Brazilian_Communist_Party
2025-07-21 11:17:41,868 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:17:42,068 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:17:42,069 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:17:42,069 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:17:42,069 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:17:42,069 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:17:42,070 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:17:42,070 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:17:42,070 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:17:42,070 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:17:42,070 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:17:42,094 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:17:42,095 - WARNING -   å…³ç³» 'condemn' æœªæ‰¾åˆ°åŒ¹é…
2025-07-21 11:17:42,095 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:17:42,096 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:17:42,159 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:18:12,687 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:18:12,687 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1570 å­—ç¬¦
2025-07-21 11:18:12,687 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    # æ˜ å°„å…³ç³»
    relation_mapping = {
        'condemn': ['Criticize_or_denounce']
    }
    
    # æ ‡å‡†åŒ–å®ä½“åç§°æ ¼å¼
    brazil_ministry_variations = [
        'Brazilian_Ministry_of_Agriculture_Fishing_and_Forestry',
        'Brazilian_Ministry_of_Agriculture,_Fishing_and_Forestry',
        'Brazil_Ministry_of_Agriculture_Fishing_Forestry'
    ]
    france_variations = ['France', 'French_Government']
    
    # 1. é¦–å…ˆæ‰¾åˆ°å·´è¥¿å†œä¸šéƒ¨è°´è´£æ³•å›½çš„æ—¶é—´ç‚¹
    # æ„å»ºæŸ¥è¯¢æ¡ä»¶
    brazil_condemn_condition = (
        df['head'].str.contains('|'.join(brazil_ministry_variations), case=False) &
        df['relation'].isin(relation_mapping['condemn']) &
        df['tail'].str.contains('|'.join(france_variations), case=False)
    )
    
    brazil_condemn_events = df[brazil_condemn_condition]
    
    if brazil_condemn_events.empty:
        return []
    
    # è·å–å·´è¥¿å†œä¸šéƒ¨è°´è´£æ³•å›½çš„æœ€æ—©æ—¶é—´ï¼ˆå› ä¸ºå¯èƒ½æœ‰å¤šæ¬¡ï¼‰
    brazil_time = brazil_condemn_events['timestamp'].min()
    
    # 2. æŸ¥è¯¢åœ¨å·´è¥¿å†œä¸šéƒ¨ä¹‹å‰è°´è´£æ³•å›½çš„æ‰€æœ‰äº‹ä»¶
    condemn_condition = (
        (df['relation'].isin(relation_mapping['condemn'])) &
        (df['tail'].str.contains('|'.join(france_variations), case=False)) &
        (df['timestamp'] < brazil_time)
    )
    
    condemn_events = df[condemn_condition]
    
    if condemn_events.empty:
        return []
    
    # 3. æ‰¾å‡ºæ—¶é—´ä¸Šæœ€æ¥è¿‘å·´è¥¿å†œä¸šéƒ¨çš„äº‹ä»¶ï¼ˆå³æœ€åä¸€ä¸ªï¼‰
    # æŒ‰æ—¶é—´æ’åº
    condemn_events = condemn_events.sort_values('timestamp', ascending=False)
    
    # è·å–æœ€åä¸€ä¸ªäº‹ä»¶çš„å›½å®¶
    last_country = condemn_events.iloc[0]['head']
    
    # è¿”å›å¤„ç†åçš„å®ä½“åç§°ï¼ˆä¸‹åˆ’çº¿è½¬ç©ºæ ¼ï¼‰
    return [last_country.replace('_', ' ')]
2025-07-21 11:18:12,687 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:18:12,971 - INFO - æŸ¥è¯¢è¿”å› 0 ä¸ªç»“æœ: []
2025-07-21 11:18:12,971 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:18:12,971 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:18:12,971 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:18:12,971 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Mexico']
2025-07-21 11:18:12,971 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:18:12,971 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:18:12,971 - INFO -   å¤„ç†æ—¶é—´: 40.841ç§’
2025-07-21 11:18:12,972 - INFO - ç»“æœå·²ä¿å­˜åˆ°: /mnt/nvme0n1/tyj/TKGQA/MY/intermediate_results_20250721_111812.json
2025-07-21 11:18:12,972 - INFO - å·²ä¿å­˜ä¸­é—´ç»“æœ (5/6)
2025-07-21 11:18:12,972 - INFO - å¤„ç†é—®é¢˜ 6: 2018890
2025-07-21 11:18:12,972 - INFO - é—®é¢˜: Who received Juan Carlos I's visit from Juan Carlos I on the same month of Qatar?
2025-07-21 11:18:12,972 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Royal Administration (Spain)', 'Royal Administration (Jordan)', 'Royal Administration (Saudi Arabia)']
2025-07-21 11:18:12,972 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:18:13,027 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:18:22,656 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Juan Carlos I', 'Qatar'], 'target_relations': ['received visit from'], 'time_constraints': 'same month', 'answer_type': 'entity', 'query_strategy': 'Find the entity that received a visit from Juan Carlos I in the same month as the event involving Qatar.'}
2025-07-21 11:18:22,656 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Juan Carlos I', 'Qatar'], 'target_relations': ['received visit from'], 'time_constraints': 'same month', 'answer_type': 'entity', 'query_strategy': 'Find the entity that received a visit from Juan Carlos I in the same month as the event involving Qatar.'}
2025-07-21 11:18:22,656 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:18:22,656 - INFO - æ£€æŸ¥å®ä½“: 'Juan Carlos I'
2025-07-21 11:18:23,019 - INFO -   æ¨¡å¼ 'Juan_Carlos_I' åŒ¹é…æˆåŠŸ:
2025-07-21 11:18:23,019 - INFO -     ä½œä¸ºhead: 181 æ¡è®°å½•
2025-07-21 11:18:23,019 - INFO -       Juan_Carlos_I -> Host_a_visit -> Solomon_Passy (2005-01-08)
2025-07-21 11:18:23,020 - INFO -       Juan_Carlos_I -> Make_a_visit -> Muhammad_VI (2005-01-17)
2025-07-21 11:18:23,020 - INFO -       Juan_Carlos_I -> Praise_or_endorse -> Muhammad_VI (2005-01-18)
2025-07-21 11:18:23,020 - INFO -     ä½œä¸ºtail: 159 æ¡è®°å½•
2025-07-21 11:18:23,021 - INFO -       Solomon_Passy -> Make_a_visit -> Juan_Carlos_I (2005-01-08)
2025-07-21 11:18:23,021 - INFO -       Muhammad_VI -> Host_a_visit -> Juan_Carlos_I (2005-01-17)
2025-07-21 11:18:23,021 - INFO -       Muhammad_VI -> Praise_or_endorse -> Juan_Carlos_I (2005-01-17)
2025-07-21 11:18:23,021 - INFO - æ£€æŸ¥å®ä½“: 'Qatar'
2025-07-21 11:18:23,205 - INFO -   æ¨¡å¼ 'Qatar' åŒ¹é…æˆåŠŸ:
2025-07-21 11:18:23,205 - INFO -     ä½œä¸ºhead: 1702 æ¡è®°å½•
2025-07-21 11:18:23,205 - INFO -       Government_(Qatar) -> Make_statement -> Qatar (2005-01-08)
2025-07-21 11:18:23,206 - INFO -       Qatar -> Express_intent_to_cooperate -> Kuwait (2005-02-07)
2025-07-21 11:18:23,206 - INFO -       Treasury/Finance_Ministry_(Qatar) -> Make_statement -> Sheikh_Hamad_bin_Khalifa_al-Thani (2005-02-08)
2025-07-21 11:18:23,206 - INFO -     ä½œä¸ºtail: 2058 æ¡è®°å½•
2025-07-21 11:18:23,206 - INFO -       Government_(Qatar) -> Make_statement -> Qatar (2005-01-08)
2025-07-21 11:18:23,206 - INFO -       Al_Jazeera -> Make_statement -> Qatar (2005-01-23)
2025-07-21 11:18:23,206 - INFO -       Gerhard_SchrÃ¶der -> Express_intent_to_meet_or_negotiate -> Qatar (2005-01-31)
2025-07-21 11:18:23,206 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:18:23,229 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:18:23,230 - INFO -   å…³ç³» 'received visit from' æ¨¡ç³ŠåŒ¹é…: ['Host_a_visit', 'Make_a_visit']
2025-07-21 11:18:23,262 - INFO -     'Host_a_visit': 24411 æ¡è®°å½•
2025-07-21 11:18:23,294 - INFO -     'Make_a_visit': 24422 æ¡è®°å½•
2025-07-21 11:18:23,294 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:18:23,294 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:18:23,346 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:18:43,074 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:18:43,074 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1425 å­—ç¬¦
2025-07-21 11:18:43,074 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    # Step 1: Find all visits made by Juan Carlos I
    juan_visits = df[
        (df['head'].str.contains('Juan_Carlos_I|Juan Carlos I', case=False, regex=True)) &
        (df['relation'].isin(['Make_a_visit', 'Host_a_visit', 'Express_intent_to_meet_or_negotiate']))
    ].copy()
    
    # Step 2: Find all events involving Qatar to get the target month
    qatar_events = df[
        (df['head'].str.contains('Qatar', case=False) | 
        (df['tail'].str.contains('Qatar', case=False))
    ].copy()
    
    if qatar_events.empty or juan_visits.empty:
        return []
    
    # Extract month from timestamps
    juan_visits['month'] = pd.to_datetime(juan_visits['timestamp']).dt.to_period('M')
    qatar_events['month'] = pd.to_datetime(qatar_events['timestamp']).dt.to_period('M')
    
    # Get all unique months from Qatar events
    target_months = qatar_events['month'].unique()
    
    # Filter Juan's visits to only those in the same months as Qatar events
    same_month_visits = juan_visits[juan_visits['month'].isin(target_months)]
    
    if same_month_visits.empty:
        return []
    
    # Get the recipients of these visits (tail entities)
    recipients = same_month_visits['tail'].unique()
    
    # Convert entity names back to natural format (replace underscores with spaces)
    result = [r.replace('_', ' ') for r in recipients]
    
    return result
2025-07-21 11:18:43,074 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:18:43,074 - ERROR - æŸ¥è¯¢æ‰§è¡Œå¤±è´¥: closing parenthesis ']' does not match opening parenthesis '(' on line 12 (<string>, line 14)
2025-07-21 11:18:43,075 - ERROR - é”™è¯¯è¯¦æƒ…: Traceback (most recent call last):
  File "/mnt/nvme0n1/tyj/TKGQA/MY/query_executor.py", line 29, in execute_query
    exec(query_code, exec_globals)
  File "<string>", line 14
    ].copy()
    ^
SyntaxError: closing parenthesis ']' does not match opening parenthesis '(' on line 12

2025-07-21 11:18:43,075 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:18:43,075 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:18:43,075 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:18:43,075 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Royal Administration (Spain)', 'Royal Administration (Jordan)', 'Royal Administration (Saudi Arabia)']
2025-07-21 11:18:43,075 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:18:43,075 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:18:43,075 - INFO -   å¤„ç†æ—¶é—´: 30.103ç§’
2025-07-21 11:18:43,076 - INFO - ç»“æœå·²ä¿å­˜åˆ°: /mnt/nvme0n1/tyj/TKGQA/MY/final_results_20250721_111843.json
2025-07-21 11:18:43,076 - INFO - å®éªŒå®Œæˆï¼Œè¯·æŸ¥çœ‹ç»“æœæ–‡ä»¶è·å–è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
2025-07-21 11:18:43,076 - INFO - âœ… å®éªŒæˆåŠŸå®Œæˆï¼
2025-07-21 11:18:43,076 - INFO - ğŸ“Š å¤„ç†é—®é¢˜æ•°: 6
2025-07-21 11:18:43,076 - INFO - ğŸ“ ç»“æœä¿å­˜åœ¨: /mnt/nvme0n1/tyj/TKGQA/MY/
