2025-07-21 11:21:02,292 - INFO - æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œæ—¥å¿—æ–‡ä»¶: /mnt/nvme0n1/tyj/TKGQA/MY/logs/experiment_20250721_112102.log
2025-07-21 11:21:02,324 - INFO - TemporalKGQASystem åˆå§‹åŒ–å®Œæˆ
2025-07-21 11:21:02,324 - INFO - åŠ è½½çŸ¥è¯†å›¾è°±: MY/data/output/full_df.txt
2025-07-21 11:21:02,699 - INFO - æ•°æ®å½¢çŠ¶: (461329, 4)
2025-07-21 11:21:02,699 - INFO - åˆ—å: ['head', 'relation', 'tail', 'timestamp']
2025-07-21 11:21:02,736 - INFO - çŸ¥è¯†å›¾è°±åŠ è½½å®Œæˆï¼Œå…± 461329 æ¡è®°å½•
2025-07-21 11:21:02,736 - INFO - æ—¶é—´èŒƒå›´: 2005-01-01 00:00:00 åˆ° 2015-12-31 00:00:00
2025-07-21 11:21:02,736 - INFO - åŠ è½½é—®é¢˜æ•°æ®: MY/data/multitq/questions/question_6.json
2025-07-21 11:21:02,737 - INFO - é—®é¢˜æ•°æ®åŠ è½½å®Œæˆï¼Œå…± 6 ä¸ªé—®é¢˜
2025-07-21 11:21:02,737 - INFO - å¤„ç†é—®é¢˜ 1: 2056020
2025-07-21 11:21:02,737 - INFO - é—®é¢˜: When did Walker San Miguel first express interest in working with Bolivia?
2025-07-21 11:21:02,737 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['2007-07-24']
2025-07-21 11:21:02,737 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:21:02,993 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:21:11,063 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'time_query', 'key_entities': ['Walker San Miguel', 'Bolivia'], 'target_relations': ['express interest in working with'], 'time_constraints': '', 'answer_type': 'time', 'query_strategy': "æŸ¥è¯¢Walker San Miguelä¸Boliviaä¹‹é—´'express interest in working with'å…³ç³»çš„æœ€æ—©æ—¶é—´ç‚¹"}
2025-07-21 11:21:11,064 - INFO - åˆ†æç»“æœ: {'question_type': 'time_query', 'key_entities': ['Walker San Miguel', 'Bolivia'], 'target_relations': ['express interest in working with'], 'time_constraints': '', 'answer_type': 'time', 'query_strategy': "æŸ¥è¯¢Walker San Miguelä¸Boliviaä¹‹é—´'express interest in working with'å…³ç³»çš„æœ€æ—©æ—¶é—´ç‚¹"}
2025-07-21 11:21:11,064 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:21:11,064 - INFO - æ£€æŸ¥å®ä½“: 'Walker San Miguel'
2025-07-21 11:21:11,472 - INFO -   æ¨¡å¼ 'Walker_San_Miguel' åŒ¹é…æˆåŠŸ:
2025-07-21 11:21:11,472 - INFO -     ä½œä¸ºhead: 27 æ¡è®°å½•
2025-07-21 11:21:11,472 - INFO -       Walker_San_Miguel -> Make_a_visit -> China (2006-08-30)
2025-07-21 11:21:11,472 - INFO -       Walker_San_Miguel -> Praise_or_endorse -> China (2006-08-30)
2025-07-21 11:21:11,472 - INFO -       Walker_San_Miguel -> Make_statement -> Evo_Morales (2006-09-19)
2025-07-21 11:21:11,472 - INFO -     ä½œä¸ºtail: 14 æ¡è®°å½•
2025-07-21 11:21:11,473 - INFO -       China -> Host_a_visit -> Walker_San_Miguel (2006-08-30)
2025-07-21 11:21:11,473 - INFO -       Walker_San_Miguel -> Make_statement -> Walker_San_Miguel (2006-11-02)
2025-07-21 11:21:11,473 - INFO -       Bolivia -> Consult -> Walker_San_Miguel (2006-11-04)
2025-07-21 11:21:11,473 - INFO - æ£€æŸ¥å®ä½“: 'Bolivia'
2025-07-21 11:21:11,658 - INFO -   æ¨¡å¼ 'Bolivia' åŒ¹é…æˆåŠŸ:
2025-07-21 11:21:11,658 - INFO -     ä½œä¸ºhead: 945 æ¡è®°å½•
2025-07-21 11:21:11,659 - INFO -       Bolivia -> Host_a_visit -> Combatant_(Argentina) (2005-01-06)
2025-07-21 11:21:11,659 - INFO -       Bolivia -> Rally_opposition_against -> France (2005-01-11)
2025-07-21 11:21:11,659 - INFO -       Bolivia -> Consult -> China (2005-01-27)
2025-07-21 11:21:11,659 - INFO -     ä½œä¸ºtail: 1335 æ¡è®°å½•
2025-07-21 11:21:11,659 - INFO -       Combatant_(Argentina) -> Make_a_visit -> Bolivia (2005-01-06)
2025-07-21 11:21:11,659 - INFO -       Rodrigo_Rato -> Express_intent_to_meet_or_negotiate -> Bolivia (2005-01-14)
2025-07-21 11:21:11,659 - INFO -       China -> Consult -> Bolivia (2005-01-27)
2025-07-21 11:21:11,659 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:21:11,683 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:21:11,684 - INFO -   å…³ç³» 'express interest in working with' æ¨¡ç³ŠåŒ¹é…: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Express_intent_to_provide_economic_aid', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Arrest,_detain,_or_charge_with_legal_action', 'Express_intent_to_cooperate_economically', 'Express_intent_to_cooperate', 'Express_intent_to_provide_humanitarian_aid', 'Express_accord']
2025-07-21 11:21:11,711 - INFO -     'Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)': 9704 æ¡è®°å½•
2025-07-21 11:21:11,737 - INFO -     'Express_intent_to_provide_economic_aid': 576 æ¡è®°å½•
2025-07-21 11:21:11,763 - INFO -     'fight_with_small_arms_and_light_weapons': 5386 æ¡è®°å½•
2025-07-21 11:21:11,763 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:21:11,763 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:21:11,817 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:21:29,049 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:21:29,049 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1192 å­—ç¬¦
2025-07-21 11:21:29,049 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    æŸ¥è¯¢Walker San Miguelé¦–æ¬¡è¡¨è¾¾ä¸Boliviaåˆä½œæ„å‘çš„æ—¶é—´
    å‚æ•°:
        df: çŸ¥è¯†å›¾è°±DataFrameï¼ŒåŒ…å«åˆ—['head', 'relation', 'tail', 'timestamp']
    è¿”å›:
        æœ€æ—©æ—¶é—´ç‚¹çš„å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºYYYY-MM-DD HH:MM:SS
    """
    try:
        # å®ä½“åç§°å¤„ç†ï¼ˆè½¬æ¢ä¸ºçŸ¥è¯†å›¾è°±ä¸­çš„ä¸‹åˆ’çº¿æ ¼å¼ï¼‰
        head_pattern = 'Walker_San_Miguel'
        tail_pattern = 'Bolivia'
        
        # å…³ç³»æ˜ å°„ï¼ˆæ ¹æ®åˆ†æç»“æœæ˜ å°„åˆ°çŸ¥è¯†å›¾è°±ä¸­çš„å®é™…å…³ç³»ï¼‰
        relations = ['Express_intent_to_cooperate']
        
        # ç­›é€‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
        mask = (
            df['head'].str.contains(head_pattern, case=False, regex=False) &
            df['tail'].str.contains(tail_pattern, case=False, regex=False) &
            df['relation'].isin(relations)
        )
        
        filtered_df = df[mask].copy()
        
        if filtered_df.empty:
            return "No records found"
        
        # è½¬æ¢ä¸ºdatetimeæ ¼å¼å¹¶æ‰¾åˆ°æœ€æ—©çš„æ—¶é—´æˆ³
        filtered_df['timestamp'] = pd.to_datetime(filtered_df['timestamp'])
        earliest_record = filtered_df.loc[filtered_df['timestamp'].idxmin()]
        
        # è¿”å›æœ€æ—©æ—¶é—´ç‚¹
        return earliest_record['timestamp'].strftime('%Y-%m-%d %H:%M:%S')
        
    except Exception as e:
        return f"Error occurred: {str(e)}"
2025-07-21 11:21:29,049 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:21:29,236 - INFO - æŸ¥è¯¢è¿”å›å•ä¸ªç»“æœ: 2007-07-24 00:00:00
2025-07-21 11:21:29,236 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:21:29,236 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:21:29,236 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['2007-07-24 00:00:00']
2025-07-21 11:21:29,236 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['2007-07-24']
2025-07-21 11:21:29,236 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:21:29,236 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:21:29,236 - INFO -   å¤„ç†æ—¶é—´: 26.499ç§’
2025-07-21 11:21:29,236 - INFO - å¤„ç†é—®é¢˜ 2: 2027657
2025-07-21 11:21:29,236 - INFO - é—®é¢˜: Who wanted to cooperate with Japan on 23 August 2006?
2025-07-21 11:21:29,236 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Association of Southeast Asian Nations']
2025-07-21 11:21:29,236 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:21:29,292 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:21:37,438 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Japan'], 'target_relations': ['wanted to cooperate with'], 'time_constraints': '23 August 2006', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆåœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­å®šä½åˆ°2006å¹´8æœˆ23æ—¥çš„æ—¶é—´èŠ‚ç‚¹ï¼Œç„¶åæŸ¥æ‰¾ä¸Japanå­˜åœ¨'wanted to cooperate with'å…³ç³»çš„å®ä½“ã€‚"}
2025-07-21 11:21:37,439 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Japan'], 'target_relations': ['wanted to cooperate with'], 'time_constraints': '23 August 2006', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆåœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­å®šä½åˆ°2006å¹´8æœˆ23æ—¥çš„æ—¶é—´èŠ‚ç‚¹ï¼Œç„¶åæŸ¥æ‰¾ä¸Japanå­˜åœ¨'wanted to cooperate with'å…³ç³»çš„å®ä½“ã€‚"}
2025-07-21 11:21:37,439 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:21:37,439 - INFO - æ£€æŸ¥å®ä½“: 'Japan'
2025-07-21 11:21:37,628 - INFO -   æ¨¡å¼ 'Japan' åŒ¹é…æˆåŠŸ:
2025-07-21 11:21:37,628 - INFO -     ä½œä¸ºhead: 15572 æ¡è®°å½•
2025-07-21 11:21:37,628 - INFO -       Government_Official_(Japan) -> Consult -> Emperor_Akihito (2005-01-01)
2025-07-21 11:21:37,628 - INFO -       Japan -> Express_intent_to_provide_material_aid -> International_Government_Organizations (2005-01-01)
2025-07-21 11:21:37,629 - INFO -       Japan -> Consult -> China (2005-01-03)
2025-07-21 11:21:37,629 - INFO -     ä½œä¸ºtail: 18845 æ¡è®°å½•
2025-07-21 11:21:37,629 - INFO -       Emperor_Akihito -> Consult -> Government_Official_(Japan) (2005-01-01)
2025-07-21 11:21:37,629 - INFO -       China -> Threaten -> Japan (2005-01-02)
2025-07-21 11:21:37,629 - INFO -       China -> Consult -> Japan (2005-01-03)
2025-07-21 11:21:37,629 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:21:37,652 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:21:37,653 - INFO -   å…³ç³» 'wanted to cooperate with' æ¨¡ç³ŠåŒ¹é…: ['fight_with_small_arms_and_light_weapons', 'Arrest,_detain,_or_charge_with_legal_action', 'Express_intent_to_cooperate_economically', 'Express_intent_to_cooperate', 'Threaten_with_military_force', 'Cooperate_militarily', 'Cooperate_economically', 'fight_with_artillery_and_tanks', 'Express_intent_to_cooperate_on_judicial_matters', 'Threaten_with_sanctions,_boycott,_embargo']
2025-07-21 11:21:37,680 - INFO -     'fight_with_small_arms_and_light_weapons': 5386 æ¡è®°å½•
2025-07-21 11:21:37,709 - INFO -     'Arrest,_detain,_or_charge_with_legal_action': 22069 æ¡è®°å½•
2025-07-21 11:21:37,734 - INFO -     'Express_intent_to_cooperate_economically': 744 æ¡è®°å½•
2025-07-21 11:21:37,734 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:21:37,734 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:21:37,789 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:21:54,671 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:21:54,671 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1361 å­—ç¬¦
2025-07-21 11:21:54,672 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    # Map natural language relations to KG relations
    relation_mapping = {
        'wanted to cooperate with': ['Express_intent_to_cooperate', 'Engage_in_diplomatic_cooperation']
    }
    
    # Prepare query parameters
    target_entity = 'Japan'
    target_date = '2006-08-23'
    relations = relation_mapping['wanted to cooperate with']
    
    # Convert timestamp to date for comparison
    df['date'] = pd.to_datetime(df['timestamp']).dt.date
    query_date = pd.to_datetime(target_date).date()
    
    # Filter by date and entity (either head or tail contains Japan)
    date_filtered = df[df['date'] == query_date]
    entity_filtered = date_filtered[
        (date_filtered['head'].str.contains(target_entity, case=False)) | 
        (date_filtered['tail'].str.contains(target_entity, case=False))
    ]
    
    # Further filter by relations
    relation_filtered = entity_filtered[entity_filtered['relation'].isin(relations)]
    
    # Extract the other entity in the relation (not Japan)
    results = []
    for _, row in relation_filtered.iterrows():
        if row['head'].lower().find('japan') != -1:
            results.append(row['tail'].replace('_', ' '))
        else:
            results.append(row['head'].replace('_', ' '))
    
    # Remove duplicates and return
    return list(set(results))
2025-07-21 11:21:54,672 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:21:54,812 - INFO - æŸ¥è¯¢è¿”å› 2 ä¸ªç»“æœ: ['Vietnam', 'Association of Southeast Asian Nations']
2025-07-21 11:21:54,812 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:21:54,812 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:21:54,812 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['Vietnam', 'Association of Southeast Asian Nations']
2025-07-21 11:21:54,812 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Association of Southeast Asian Nations']
2025-07-21 11:21:54,812 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:21:54,812 - INFO -   ç²¾åº¦: 0.500, å¬å›ç‡: 1.000, F1: 0.667
2025-07-21 11:21:54,812 - INFO -   å¤„ç†æ—¶é—´: 25.576ç§’
2025-07-21 11:21:54,812 - INFO - å¤„ç†é—®é¢˜ 3: 2007873
2025-07-21 11:21:54,813 - INFO - é—®é¢˜: Before 11 December 2009, who used conventional military force against France?
2025-07-21 11:21:54,813 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Separatist (France)', 'Comoros', 'Royal Air Force', 'Bolivia', 'Colombia', 'Christian (France)', 'Member of Parliament (France)', 'Military (Russia)']
2025-07-21 11:21:54,813 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:21:54,886 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:22:02,981 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'entity_query', 'key_entities': ['France'], 'target_relations': ['used conventional military force against'], 'time_constraints': 'before 11 December 2009', 'answer_type': 'entity', 'query_strategy': "æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰ï¼Œå¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“ã€‚éœ€è¦æ£€ç´¢æ—¶åºçŸ¥è¯†å›¾è°±ä¸­åœ¨è¯¥æ—¶é—´ç‚¹ä¹‹å‰ä¸æ³•å›½å­˜åœ¨'used conventional military force against'å…³ç³»çš„å®ä½“ã€‚"}
2025-07-21 11:22:02,981 - INFO - åˆ†æç»“æœ: {'question_type': 'entity_query', 'key_entities': ['France'], 'target_relations': ['used conventional military force against'], 'time_constraints': 'before 11 December 2009', 'answer_type': 'entity', 'query_strategy': "æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰ï¼Œå¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“ã€‚éœ€è¦æ£€ç´¢æ—¶åºçŸ¥è¯†å›¾è°±ä¸­åœ¨è¯¥æ—¶é—´ç‚¹ä¹‹å‰ä¸æ³•å›½å­˜åœ¨'used conventional military force against'å…³ç³»çš„å®ä½“ã€‚"}
2025-07-21 11:22:02,981 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:22:02,981 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:22:03,171 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:22:03,171 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:22:03,172 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:22:03,172 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:22:03,172 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:22:03,172 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:22:03,172 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:22:03,172 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:22:03,172 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:22:03,172 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:22:03,196 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:22:03,197 - INFO -   å…³ç³» 'used conventional military force against' æ¨¡ç³ŠåŒ¹é…: ['Use_unconventional_violence', 'Use_conventional_military_force', 'Provide_military_aid', 'Mobilize_or_increase_armed_forces', 'Refuse_to_de-escalate_military_engagement', 'Bring_lawsuit_against', 'Increase_military_alert_status', 'Provide_military_protection_or_peacekeeping', 'Demonstrate_military_or_police_power', 'Rally_opposition_against']
2025-07-21 11:22:03,225 - INFO -     'Use_unconventional_violence': 9189 æ¡è®°å½•
2025-07-21 11:22:03,252 - INFO -     'Use_conventional_military_force': 9554 æ¡è®°å½•
2025-07-21 11:22:03,277 - INFO -     'Provide_military_aid': 452 æ¡è®°å½•
2025-07-21 11:22:03,277 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:22:03,278 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:22:03,331 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:22:18,595 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:22:18,595 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 965 å­—ç¬¦
2025-07-21 11:22:18,595 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    æŸ¥è¯¢åœ¨2009å¹´12æœˆ11æ—¥ä¹‹å‰ï¼Œå¯¹æ³•å›½ä½¿ç”¨å¸¸è§„å†›äº‹åŠ›é‡çš„å®ä½“
    
    å‚æ•°:
        df: æ—¶åºçŸ¥è¯†å›¾è°±DataFrameï¼ŒåŒ…å«åˆ—['head', 'relation', 'tail', 'timestamp']
    
    è¿”å›:
        list: ç¬¦åˆæ¡ä»¶çš„å®ä½“åç§°åˆ—è¡¨(ä¸‹åˆ’çº¿è½¬ç©ºæ ¼)
    """
    # å®šä¹‰ç›®æ ‡å®ä½“å’Œå…³ç³»æ˜ å°„
    target_entity = "France"
    relation_mapping = "Use_conventional_military_force"
    time_threshold = "2009-12-11 00:00:00"
    
    try:
        # ç­›é€‰æ¡ä»¶:
        # 1. å…³ç³»åŒ¹é…æ˜ å°„åçš„å…³ç³»
        # 2. å°¾éƒ¨å®ä½“æ˜¯æ³•å›½(æ¨¡ç³ŠåŒ¹é…)
        # 3. æ—¶é—´åœ¨2009-12-11ä¹‹å‰
        filtered = df[
            (df['relation'] == relation_mapping) &
            (df['tail'].str.contains(target_entity, case=False)) &
            (df['timestamp'] < time_threshold)
        ]
        
        # è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å¤´éƒ¨å®ä½“
        entities = filtered['head'].unique().tolist()
        
        # å°†ä¸‹åˆ’çº¿è½¬æ¢ä¸ºç©ºæ ¼
        result = [e.replace('_', ' ') for e in entities]
        
        return result
    
    except Exception as e:
        print(f"æŸ¥è¯¢è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")
        return []
2025-07-21 11:22:18,595 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:22:18,821 - INFO - æŸ¥è¯¢è¿”å› 16 ä¸ªç»“æœ: ['Bolivia', 'Military Personnel - Special (France)', 'Colombia', 'France', 'Military (Russia)', 'Member of Parliament (France)', 'Military (Senegal)', "Police (Cote d'Ivoire)", 'Religion (France)', 'Christian (France)', 'Royal Air Force', 'Actor (France)', 'Corsica', 'Separatist (France)', 'Comoros', 'Republican Force']
2025-07-21 11:22:18,821 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:22:18,821 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:22:18,821 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['Bolivia', 'Military Personnel - Special (France)', 'Colombia', 'France', 'Military (Russia)', 'Member of Parliament (France)', 'Military (Senegal)', "Police (Cote d'Ivoire)", 'Religion (France)', 'Christian (France)', 'Royal Air Force', 'Actor (France)', 'Corsica', 'Separatist (France)', 'Comoros', 'Republican Force']
2025-07-21 11:22:18,821 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Separatist (France)', 'Comoros', 'Royal Air Force', 'Bolivia', 'Colombia', 'Christian (France)', 'Member of Parliament (France)', 'Military (Russia)']
2025-07-21 11:22:18,821 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:22:18,821 - INFO -   ç²¾åº¦: 0.500, å¬å›ç‡: 1.000, F1: 0.667
2025-07-21 11:22:18,821 - INFO -   å¤„ç†æ—¶é—´: 24.009ç§’
2025-07-21 11:22:18,821 - INFO - å¤„ç†é—®é¢˜ 4: 2044815
2025-07-21 11:22:18,821 - INFO - é—®é¢˜: Which country was the first to ask for France after the Algerian extremist?
2025-07-21 11:22:18,822 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Iran']
2025-07-21 11:22:18,822 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:22:18,876 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:22:27,507 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Algerian extremist', 'France'], 'target_relations': ['ask for'], 'time_constraints': 'first', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆè¯†åˆ«å‡ºé—®é¢˜ä¸­çš„å…³é”®å®ä½“'Algerian extremist'å’Œ'France'ï¼Œä»¥åŠç›®æ ‡å…³ç³»'ask for'ã€‚æ—¶é—´çº¦æŸæ˜¯'first'ï¼Œè¡¨ç¤ºæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€ä¸ªå‘æ³•å›½æå‡ºè¯·æ±‚çš„å›½å®¶ã€‚ç­”æ¡ˆç±»å‹æ˜¯å®ä½“ï¼ˆå›½å®¶åç§°ï¼‰ã€‚æŸ¥è¯¢ç­–ç•¥æ˜¯åœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­æŸ¥æ‰¾'Algerian extremist'ä¹‹åï¼Œç¬¬ä¸€ä¸ªä¸'France'å»ºç«‹'ask for'å…³ç³»çš„å›½å®¶ã€‚"}
2025-07-21 11:22:27,507 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Algerian extremist', 'France'], 'target_relations': ['ask for'], 'time_constraints': 'first', 'answer_type': 'entity', 'query_strategy': "é¦–å…ˆè¯†åˆ«å‡ºé—®é¢˜ä¸­çš„å…³é”®å®ä½“'Algerian extremist'å’Œ'France'ï¼Œä»¥åŠç›®æ ‡å…³ç³»'ask for'ã€‚æ—¶é—´çº¦æŸæ˜¯'first'ï¼Œè¡¨ç¤ºæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€ä¸ªå‘æ³•å›½æå‡ºè¯·æ±‚çš„å›½å®¶ã€‚ç­”æ¡ˆç±»å‹æ˜¯å®ä½“ï¼ˆå›½å®¶åç§°ï¼‰ã€‚æŸ¥è¯¢ç­–ç•¥æ˜¯åœ¨æ—¶åºçŸ¥è¯†å›¾è°±ä¸­æŸ¥æ‰¾'Algerian extremist'ä¹‹åï¼Œç¬¬ä¸€ä¸ªä¸'France'å»ºç«‹'ask for'å…³ç³»çš„å›½å®¶ã€‚"}
2025-07-21 11:22:27,507 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:22:27,507 - INFO - æ£€æŸ¥å®ä½“: 'Algerian extremist'
2025-07-21 11:22:28,404 - WARNING -   å®ä½“ 'Algerian extremist' çš„æ‰€æœ‰æ¨¡å¼éƒ½æœªæ‰¾åˆ°
2025-07-21 11:22:28,777 - INFO -     éƒ¨åˆ†åŒ¹é… 'extremist': 242 æ¡è®°å½•
2025-07-21 11:22:28,777 - INFO -       Agence_France-Presse -> Make_statement -> Extremist_(Algeria)
2025-07-21 11:22:28,777 - INFO -       Islamic_Extremist_Group_(Islamic_Jihad) -> fight_with_small_arms_and_light_weapons -> Israeli_Defense_Forces
2025-07-21 11:22:28,778 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:22:28,973 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:22:28,973 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:22:28,973 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:22:28,974 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:22:28,974 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:22:28,974 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:22:28,974 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:22:28,974 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:22:28,974 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:22:28,974 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:22:28,998 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:22:28,999 - WARNING -   å…³ç³» 'ask for' æœªæ‰¾åˆ°åŒ¹é…
2025-07-21 11:22:28,999 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:22:28,999 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:22:29,058 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:22:48,689 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:22:48,689 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1922 å­—ç¬¦
2025-07-21 11:22:48,689 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    Query the temporal knowledge graph to find which country was the first to ask for France 
    after the Algerian extremist.
    
    Args:
        df (pd.DataFrame): Knowledge graph dataframe with columns ['head', 'relation', 'tail', 'timestamp']
        
    Returns:
        list: List of country names (with underscores replaced by spaces)
    """
    # Map question relations to KG relations
    relation_mapping = {
        'ask for': ['Make_an_appeal_or_request', 'Appeal_to']
    }
    
    try:
        # Step 1: Find all events involving Algerian extremist
        algerian_events = df[df['head'].str.contains('Algerian_extremist', case=False, regex=False) | 
                            df['tail'].str.contains('Algerian_extremist', case=False, regex=False)]
        
        if algerian_events.empty:
            return []
            
        # Get the latest timestamp of Algerian extremist events
        latest_algerian_time = algerian_events['timestamp'].max()
        
        # Step 2: Find all ask_for events to France after that time
        ask_for_relations = relation_mapping['ask for']
        france_events = df[
            (df['tail'].str.contains('France', case=False, regex=False)) &
            (df['relation'].isin(ask_for_relations)) &
            (df['timestamp'] > latest_algerian_time)
        ]
        
        if france_events.empty:
            return []
            
        # Step 3: Find the earliest such event
        first_request = france_events.loc[france_events['timestamp'].idxmin()]
        
        # Step 4: Get the requesting country (head entity)
        requesting_country = first_request['head']
        
        # Return as list with underscores replaced by spaces
        return [requesting_country.replace('_', ' ')]
        
    except Exception as e:
        print(f"Error during query: {e}")
        return []
2025-07-21 11:22:48,689 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:22:48,872 - INFO - æŸ¥è¯¢è¿”å› 0 ä¸ªç»“æœ: []
2025-07-21 11:22:48,873 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:22:48,873 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:22:48,873 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:22:48,873 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Iran']
2025-07-21 11:22:48,873 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:22:48,873 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:22:48,873 - INFO -   å¤„ç†æ—¶é—´: 30.051ç§’
2025-07-21 11:22:48,873 - INFO - å¤„ç†é—®é¢˜ 5: 2016117
2025-07-21 11:22:48,873 - INFO - é—®é¢˜: Before the Brazilian Ministry of Agriculture, Fishing and Forestry, which country was the last to condemn France?
2025-07-21 11:22:48,873 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Mexico']
2025-07-21 11:22:48,873 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:22:48,927 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:22:56,558 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'entity_query', 'key_entities': ['Brazilian Ministry of Agriculture, Fishing and Forestry', 'France'], 'target_relations': ['condemn'], 'time_constraints': 'before the Brazilian Ministry of Agriculture, Fishing and Forestry', 'answer_type': 'entity', 'query_strategy': "Find the last country that condemned France before the Brazilian Ministry of Agriculture, Fishing and Forestry did. This involves identifying the temporal sequence of condemnations and selecting the one immediately preceding the Brazilian Ministry's action."}
2025-07-21 11:22:56,558 - INFO - åˆ†æç»“æœ: {'question_type': 'entity_query', 'key_entities': ['Brazilian Ministry of Agriculture, Fishing and Forestry', 'France'], 'target_relations': ['condemn'], 'time_constraints': 'before the Brazilian Ministry of Agriculture, Fishing and Forestry', 'answer_type': 'entity', 'query_strategy': "Find the last country that condemned France before the Brazilian Ministry of Agriculture, Fishing and Forestry did. This involves identifying the temporal sequence of condemnations and selecting the one immediately preceding the Brazilian Ministry's action."}
2025-07-21 11:22:56,558 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:22:56,558 - INFO - æ£€æŸ¥å®ä½“: 'Brazilian Ministry of Agriculture, Fishing and Forestry'
2025-07-21 11:22:57,403 - WARNING -   å®ä½“ 'Brazilian Ministry of Agriculture, Fishing and Forestry' çš„æ‰€æœ‰æ¨¡å¼éƒ½æœªæ‰¾åˆ°
2025-07-21 11:22:57,589 - INFO -     éƒ¨åˆ†åŒ¹é… 'Brazilian': 4 æ¡è®°å½•
2025-07-21 11:22:57,589 - INFO -       Brazilian_Communist_Party -> Engage_in_material_cooperation -> Socialism_and_Freedom_Party
2025-07-21 11:22:57,589 - INFO -       Socialism_and_Freedom_Party -> Engage_in_material_cooperation -> Brazilian_Communist_Party
2025-07-21 11:22:57,589 - INFO - æ£€æŸ¥å®ä½“: 'France'
2025-07-21 11:22:57,788 - INFO -   æ¨¡å¼ 'France' åŒ¹é…æˆåŠŸ:
2025-07-21 11:22:57,788 - INFO -     ä½œä¸ºhead: 9930 æ¡è®°å½•
2025-07-21 11:22:57,789 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Police_(Kenya) (2005-01-03)
2025-07-21 11:22:57,789 - INFO -       Government_(France) -> Praise_or_endorse -> Citizen_(Sudan) (2005-01-04)
2025-07-21 11:22:57,789 - INFO -       Agence_France-Presse -> Discuss_by_telephone -> Ange-FÃ©lix_PatassÃ© (2005-01-05)
2025-07-21 11:22:57,789 - INFO -     ä½œä¸ºtail: 10102 æ¡è®°å½•
2025-07-21 11:22:57,789 - INFO -       Police_(Kenya) -> Discuss_by_telephone -> Agence_France-Presse (2005-01-03)
2025-07-21 11:22:57,790 - INFO -       Serge_Lepeltier -> Make_statement -> France (2005-01-04)
2025-07-21 11:22:57,790 - INFO -       Ange-FÃ©lix_PatassÃ© -> Discuss_by_telephone -> Agence_France-Presse (2005-01-05)
2025-07-21 11:22:57,790 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:22:57,814 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:22:57,815 - WARNING -   å…³ç³» 'condemn' æœªæ‰¾åˆ°åŒ¹é…
2025-07-21 11:22:57,815 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:22:57,816 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:22:57,873 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:23:16,110 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:23:16,110 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1729 å­—ç¬¦
2025-07-21 11:23:16,110 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    """
    Find the last country that condemned France before the Brazilian Ministry of Agriculture, Fishing and Forestry did.
    
    Args:
        df: DataFrame with columns ['head', 'relation', 'tail', 'timestamp']
    
    Returns:
        List of entity names (with underscores replaced by spaces)
    """
    try:
        # Map relations to KG format
        condemn_relation = "Criticize_or_denounce"
        
        # Find Brazilian Ministry's condemnation timestamp
        ministry_mask = (
            df['head'].str.contains('Brazilian_Ministry_of_Agriculture', case=False, regex=False) &
            (df['relation'] == condemn_relation) &
            df['tail'].str.contains('France', case=False, regex=False)
        )
        
        ministry_condemnations = df[ministry_mask]
        if ministry_condemnations.empty:
            return []
        
        ministry_time = ministry_condemnations['timestamp'].max()
        
        # Find all condemnations of France before the ministry's action
        condemn_mask = (
            (df['relation'] == condemn_relation) &
            df['tail'].str.contains('France', case=False, regex=False) &
            (df['timestamp'] < ministry_time)
        )
        
        condemnations = df[condemn_mask]
        if condemnations.empty:
            return []
        
        # Get the latest condemnation before ministry's action
        last_condemnation = condemnations.loc[condemnations['timestamp'].idxmax()]
        
        # Return the condemning country (head entity)
        return [last_condemnation['head'].replace('_', ' ')]
    
    except Exception as e:
        print(f"Error in query: {e}")
        return []
2025-07-21 11:23:16,111 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:23:16,315 - INFO - æŸ¥è¯¢è¿”å› 0 ä¸ªç»“æœ: []
2025-07-21 11:23:16,315 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:23:16,315 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:23:16,315 - INFO -   é¢„æµ‹ç­”æ¡ˆ: []
2025-07-21 11:23:16,315 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Mexico']
2025-07-21 11:23:16,315 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:23:16,316 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:23:16,316 - INFO -   å¤„ç†æ—¶é—´: 27.442ç§’
2025-07-21 11:23:16,316 - INFO - ç»“æœå·²ä¿å­˜åˆ°: /mnt/nvme0n1/tyj/TKGQA/MY/intermediate_results_20250721_112316.json
2025-07-21 11:23:16,316 - INFO - å·²ä¿å­˜ä¸­é—´ç»“æœ (5/6)
2025-07-21 11:23:16,316 - INFO - å¤„ç†é—®é¢˜ 6: 2018890
2025-07-21 11:23:16,316 - INFO - é—®é¢˜: Who received Juan Carlos I's visit from Juan Carlos I on the same month of Qatar?
2025-07-21 11:23:16,316 - INFO - æ ‡å‡†ç­”æ¡ˆ: ['Royal Administration (Spain)', 'Royal Administration (Jordan)', 'Royal Administration (Saudi Arabia)']
2025-07-21 11:23:16,316 - INFO - æ­¥éª¤1: é—®é¢˜åˆ†æ
2025-07-21 11:23:16,372 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:23:23,833 - INFO - é—®é¢˜åˆ†æå®Œæˆ: {'question_type': 'relation_query', 'key_entities': ['Juan Carlos I', 'Qatar'], 'target_relations': ['received visit from'], 'time_constraints': 'same month', 'answer_type': 'entity', 'query_strategy': 'Find the entity that received a visit from Juan Carlos I in the same month as the event involving Qatar.'}
2025-07-21 11:23:23,833 - INFO - åˆ†æç»“æœ: {'question_type': 'relation_query', 'key_entities': ['Juan Carlos I', 'Qatar'], 'target_relations': ['received visit from'], 'time_constraints': 'same month', 'answer_type': 'entity', 'query_strategy': 'Find the entity that received a visit from Juan Carlos I in the same month as the event involving Qatar.'}
2025-07-21 11:23:23,833 - INFO - === KGå®ä½“å’Œå…³ç³»æ£€æŸ¥ ===
2025-07-21 11:23:23,833 - INFO - æ£€æŸ¥å®ä½“: 'Juan Carlos I'
2025-07-21 11:23:24,213 - INFO -   æ¨¡å¼ 'Juan_Carlos_I' åŒ¹é…æˆåŠŸ:
2025-07-21 11:23:24,214 - INFO -     ä½œä¸ºhead: 181 æ¡è®°å½•
2025-07-21 11:23:24,214 - INFO -       Juan_Carlos_I -> Host_a_visit -> Solomon_Passy (2005-01-08)
2025-07-21 11:23:24,214 - INFO -       Juan_Carlos_I -> Make_a_visit -> Muhammad_VI (2005-01-17)
2025-07-21 11:23:24,214 - INFO -       Juan_Carlos_I -> Praise_or_endorse -> Muhammad_VI (2005-01-18)
2025-07-21 11:23:24,214 - INFO -     ä½œä¸ºtail: 159 æ¡è®°å½•
2025-07-21 11:23:24,214 - INFO -       Solomon_Passy -> Make_a_visit -> Juan_Carlos_I (2005-01-08)
2025-07-21 11:23:24,214 - INFO -       Muhammad_VI -> Host_a_visit -> Juan_Carlos_I (2005-01-17)
2025-07-21 11:23:24,214 - INFO -       Muhammad_VI -> Praise_or_endorse -> Juan_Carlos_I (2005-01-17)
2025-07-21 11:23:24,215 - INFO - æ£€æŸ¥å®ä½“: 'Qatar'
2025-07-21 11:23:24,403 - INFO -   æ¨¡å¼ 'Qatar' åŒ¹é…æˆåŠŸ:
2025-07-21 11:23:24,403 - INFO -     ä½œä¸ºhead: 1702 æ¡è®°å½•
2025-07-21 11:23:24,403 - INFO -       Government_(Qatar) -> Make_statement -> Qatar (2005-01-08)
2025-07-21 11:23:24,403 - INFO -       Qatar -> Express_intent_to_cooperate -> Kuwait (2005-02-07)
2025-07-21 11:23:24,404 - INFO -       Treasury/Finance_Ministry_(Qatar) -> Make_statement -> Sheikh_Hamad_bin_Khalifa_al-Thani (2005-02-08)
2025-07-21 11:23:24,404 - INFO -     ä½œä¸ºtail: 2058 æ¡è®°å½•
2025-07-21 11:23:24,404 - INFO -       Government_(Qatar) -> Make_statement -> Qatar (2005-01-08)
2025-07-21 11:23:24,404 - INFO -       Al_Jazeera -> Make_statement -> Qatar (2005-01-23)
2025-07-21 11:23:24,404 - INFO -       Gerhard_SchrÃ¶der -> Express_intent_to_meet_or_negotiate -> Qatar (2005-01-31)
2025-07-21 11:23:24,404 - INFO - æ£€æŸ¥ç›®æ ‡å…³ç³»:
2025-07-21 11:23:24,428 - INFO - KGä¸­çš„å…³ç³»ç±»å‹ç¤ºä¾‹: ['Express_intent_to_engage_in_diplomatic_cooperation_(such_as_policy_support)', 'Make_statement', 'Praise_or_endorse', 'Consult', 'Discuss_by_telephone', 'Make_pessimistic_comment', 'Make_an_appeal_or_request', 'Express_intent_to_provide_economic_aid', 'Provide_aid', 'Reject', 'Use_unconventional_violence', 'Engage_in_diplomatic_cooperation', 'fight_with_small_arms_and_light_weapons', 'Express_intent_to_provide_material_aid', 'Express_intent_to_meet_or_negotiate', 'Accuse', 'Arrest,_detain,_or_charge_with_legal_action', 'Use_conventional_military_force', 'Provide_humanitarian_aid', 'Criticize_or_denounce']
2025-07-21 11:23:24,428 - INFO -   å…³ç³» 'received visit from' æ¨¡ç³ŠåŒ¹é…: ['Host_a_visit', 'Make_a_visit']
2025-07-21 11:23:24,459 - INFO -     'Host_a_visit': 24411 æ¡è®°å½•
2025-07-21 11:23:24,491 - INFO -     'Make_a_visit': 24422 æ¡è®°å½•
2025-07-21 11:23:24,491 - INFO - === KGæ£€æŸ¥å®Œæˆ ===
2025-07-21 11:23:24,491 - INFO - æ­¥éª¤2: ä»£ç ç”Ÿæˆ
2025-07-21 11:23:24,543 - INFO - HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
2025-07-21 11:23:42,846 - INFO - ä»£ç ç”ŸæˆæˆåŠŸ
2025-07-21 11:23:42,846 - INFO - ç”Ÿæˆçš„ä»£ç é•¿åº¦: 1354 å­—ç¬¦
2025-07-21 11:23:42,846 - INFO - ç”Ÿæˆçš„ä»£ç :
import pandas as pd

def query_kg(df):
    # Map the relation to KG's actual relation name
    target_relation = "Host_a_visit"
    
    # Find all visits involving Juan_Carlos_I
    juan_visits = df[
        (df['head'].str.contains('Juan_Carlos_I', case=False, regex=False)) & 
        (df['relation'] == 'Make_a_visit')
    ].copy()
    
    # Find all visits involving Qatar
    qatar_visits = df[
        (df['tail'].str.contains('Qatar', case=False, regex=False)) & 
        (df['relation'] == 'Host_a_visit')
    ].copy()
    
    if juan_visits.empty or qatar_visits.empty:
        return []
    
    # Extract month from timestamps
    juan_visits['month'] = pd.to_datetime(juan_visits['timestamp']).dt.to_period('M')
    qatar_visits['month'] = pd.to_datetime(qatar_visits['timestamp']).dt.to_period('M')
    
    # Find matching months
    matching_months = set(juan_visits['month']).intersection(set(qatar_visits['month']))
    
    if not matching_months:
        return []
    
    # Get all visits by Juan Carlos I in matching months
    result_visits = juan_visits[juan_visits['month'].isin(matching_months)]
    
    # Get unique entities that received visits
    result_entities = result_visits['tail'].unique()
    
    # Convert underscores to spaces in entity names
    return [entity.replace('_', ' ') for entity in result_entities]
2025-07-21 11:23:42,846 - INFO - æ­¥éª¤3: æ‰§è¡ŒæŸ¥è¯¢
2025-07-21 11:23:43,098 - INFO - æŸ¥è¯¢è¿”å› 5 ä¸ªç»“æœ: ['China', 'United Arab Emirates', 'Trinidad and Tobago', 'Portugal', 'Kuwait']
2025-07-21 11:23:43,099 - INFO - æ­¥éª¤4: è¯„ä¼°ç»“æœ
2025-07-21 11:23:43,099 - INFO - è¯„ä¼°ç»“æœ:
2025-07-21 11:23:43,099 - INFO -   é¢„æµ‹ç­”æ¡ˆ: ['China', 'United Arab Emirates', 'Trinidad and Tobago', 'Portugal', 'Kuwait']
2025-07-21 11:23:43,099 - INFO -   æ ‡å‡†ç­”æ¡ˆ: ['Royal Administration (Spain)', 'Royal Administration (Jordan)', 'Royal Administration (Saudi Arabia)']
2025-07-21 11:23:43,099 - INFO -   ç²¾ç¡®åŒ¹é…: False
2025-07-21 11:23:43,099 - INFO -   ç²¾åº¦: 0.000, å¬å›ç‡: 0.000, F1: 0.000
2025-07-21 11:23:43,099 - INFO -   å¤„ç†æ—¶é—´: 26.782ç§’
2025-07-21 11:23:43,100 - INFO - ç»“æœå·²ä¿å­˜åˆ°: /mnt/nvme0n1/tyj/TKGQA/MY/final_results_20250721_112343.json
2025-07-21 11:23:43,100 - INFO - å®éªŒå®Œæˆï¼Œè¯·æŸ¥çœ‹ç»“æœæ–‡ä»¶è·å–è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
2025-07-21 11:23:43,100 - INFO - âœ… å®éªŒæˆåŠŸå®Œæˆï¼
2025-07-21 11:23:43,100 - INFO - ğŸ“Š å¤„ç†é—®é¢˜æ•°: 6
2025-07-21 11:23:43,100 - INFO - ğŸ“ ç»“æœä¿å­˜åœ¨: /mnt/nvme0n1/tyj/TKGQA/MY/
